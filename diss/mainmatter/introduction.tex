% Copyright (c) 2017, Gabriel Hjort Blindell <ghb@kth.se>
%
% This work is licensed under a Creative Commons 4.0 International License (see
% LICENSE file or visit <http://creativecommons.org/licenses/by/4.0/> for a copy
% of the license).

\chapter{Introduction}

\section{Background and Motivation}

\todo{Explain code generation}
\todo{Explain instruction selection (what, why)}
\todo{Explain global code motion (what, why)}
\todo{Explain block ordering (what, why)}
\todo{Traditional approaches (how)}
\todo{Limitations (why)}
\todo{Combinatorial optimization (what)}
\todo{Combinatorial approaches (how)}
\todo{Limitations (why)}
\todo{Research goal (what)}

\section{Thesis Statement}

\begin{statement}
  \Glstext{constraint programming} is a flexible, practical, and competitive
  approach to \glstext{instruction selection}.
\end{statement}

\todo{Define ``flexible''}
\todo{Define ``practical''}
\todo{Define ``competitive''}

\section{Approach}

\todo{Overview figure}

\section{Contributions}

This dissertation makes five contributions to the areas of code generation and
constraint programming:
%
\begin{contributions}
\item \labelContribution{survey}
    a comprehensive and structured survey that covers over four decades of
    research in \gls{instruction selection};
  \item \labelContribution{representations}
    a program and instruction representation that enables
    \begin{contributions}
      \item \labelContribution{rep-uniformity}
        uniform treatment of data- and control-flow operations, and
      \item \labelContribution{rep-complex-instructions}
        modeling and pattern matching of complex \glspl{processor instruction}
        as \glspl{pattern}, and
      \item \labelContribution{rep-combining-problems}
        modeling of \gls{global.is}[ \gls{instruction selection}] and
        \gls{global code motion} as a \gls{constraint model};
    \end{contributions}
  \item \labelContribution{constraint-model}
    a \gls{constraint model} and related transformations that, for the first
    time, integrates
    \begin{contributions}
      \item \labelContribution{cp-global-instruction-selection}
        \gls{global.is}[ \gls{instruction selection}] with
      \item \labelContribution{cp-global-code-motion}
        \gls{global code motion},
    \end{contributions}
    and also integrates
    \begin{contributions}[resume]
      \item \labelContribution{cp-data-copying}
        \gls{data copying},
      \item \labelContribution{cp-block-ordering}
        \gls{block ordering}, and
      \item \labelContribution{cp-value-reuse}
        \gls{value reuse};
    \end{contributions}
  \item \labelContribution{solving-techniques}
    solving techniques that enables practical solving of the \gls{constraint
      model}; and
  \item \labelContribution{experiments}
    thorough experiments demonstrating that the approach scales to medium-sized
    programs and yields better code than traditional approaches.
\end{contributions}
%
\refTable{contributions-per-chapter} shows in which chapters each contribution
is manifested and discussed further.

\section{Outline}

\todo{Describe chapters}
\todo{Add figure illustrating how to read the dissertation}

\begin{table}
  \centering%
  \begin{tabular}{c@{\qquad}*{11}{c}}
    \toprule
      \tabhead Chapter
    & \tabhead\refContribution{survey}
    & \multicolumn{3}{c}{\tabhead\refContribution{representations}}
    & \multicolumn{5}{c}{\tabhead\refContribution{constraint-model}}
    & \tabhead\refContribution{solving-techniques}
    & \tabhead\refContribution{experiments} \\
    \cmidrule(lr){3-5}%
    \cmidrule(lr){6-10}%
    &
    & \tabhead\refContribution{rep-uniformity}
    & \tabhead\refContribution{rep-complex-instructions}
    & \tabhead\refContribution{rep-combining-problems}
    & \tabhead\refContribution{cp-global-instruction-selection}
    & \tabhead\refContribution{cp-global-code-motion}
    & \tabhead\refContribution{cp-data-copying}
    & \tabhead\refContribution{cp-block-ordering}
    & \tabhead\refContribution{cp-value-reuse}
    &
    & \\
    \midrule
    \refChapter*{current-instruction-selection-techniques}
    & \supportYes
    & \supportNo
    & \supportNo
    & \supportNo
    & \supportNo
    & \supportNo
    & \supportNo
    & \supportNo
    & \supportNo
    & \supportNo
    & \supportNo \\
    \refChapter*{universal-representations}
    & \supportNo
    & \supportYes
    & \supportYes
    & \supportYes
    & \supportNo
    & \supportNo
    & \supportNo
    & \supportNo
    & \supportNo
    & \supportNo
    & \supportNo \\
    \refChapter*{pattern-matching}
    & \supportNo
    & \supportYes
    & \supportYes
    & \supportNo
    & \supportNo
    & \supportNo
    & \supportNo
    & \supportNo
    & \supportNo
    & \supportNo
    & \supportNo \\
    \refChapter*{modeling-global-instruction-selection}
    & \supportNo
    & \supportYes
    & \supportNo
    & \supportYes
    & \supportYes
    & \supportNo
    & \supportNo
    & \supportNo
    & \supportNo
    & \supportNo
    & \supportNo \\
    \refChapter*{modeling-global-code-motion}
    & \supportNo
    & \supportNo
    & \supportNo
    & \supportYes
    & \supportNo
    & \supportYes
    & \supportNo
    & \supportNo
    & \supportNo
    & \supportNo
    & \supportNo \\
    \refChapter*{modeling-data-copying}
    & \supportNo
    & \supportNo
    & \supportNo
    & \supportNo
    & \supportNo
    & \supportNo
    & \supportYes
    & \supportNo
    & \supportNo
    & \supportNo
    & \supportNo \\
    \refChapter*{modeling-block-ordering}
    & \supportNo
    & \supportNo
    & \supportNo
    & \supportNo
    & \supportNo
    & \supportNo
    & \supportNo
    & \supportYes
    & \supportNo
    & \supportNo
    & \supportNo \\
    \refChapter*{modeling-value-reuse}
    & \supportNo
    & \supportNo
    & \supportNo
    & \supportNo
    & \supportNo
    & \supportNo
    & \supportNo
    & \supportNo
    & \supportYes
    & \supportNo
    & \supportNo \\
    \refChapter*{solving-techniques}
    & \supportNo
    & \supportNo
    & \supportNo
    & \supportNo
    & \supportNo
    & \supportNo
    & \supportNo
    & \supportNo
    & \supportNo
    & \supportYes
    & \supportNo \\
    \refChapter*{macro-expansion}
    & \supportYes
    & \supportNo
    & \supportNo
    & \supportNo
    & \supportNo
    & \supportNo
    & \supportNo
    & \supportNo
    & \supportNo
    & \supportNo
    & \supportNo \\
    \refChapter*{tree-covering}
    & \supportYes
    & \supportNo
    & \supportNo
    & \supportNo
    & \supportNo
    & \supportNo
    & \supportNo
    & \supportNo
    & \supportNo
    & \supportNo
    & \supportNo \\
    \refChapter*{dag-covering}
    & \supportYes
    & \supportNo
    & \supportNo
    & \supportNo
    & \supportNo
    & \supportNo
    & \supportNo
    & \supportNo
    & \supportNo
    & \supportNo
    & \supportNo \\
    \refChapter*{graph-covering}
    & \supportYes
    & \supportNo
    & \supportNo
    & \supportNo
    & \supportNo
    & \supportNo
    & \supportNo
    & \supportNo
    & \supportNo
    & \supportNo
    & \supportNo \\
    \bottomrule
  \end{tabular}

  \caption{Contributions per chapter}
  \labelTable{contributions-per-chapter}
\end{table}

\section{Publications}

This dissertation is based on material presented in the following publications:
%
\begin{publications}
  \item \labelPublication{survey-book}
    \fullcite{HjortBlindell:2016:Survey}.
  \item \labelPublication{cp-paper}
    \fullcite{HjortBlindellEtAl:2015:CP}.
  \item \labelPublication{cases-paper}
    \fullcite{HjortBlindellEtAl:2017:CASES}.
\end{publications}
%
\refTable{contributions-per-publication} shows the relation between the
contributions and the publications above.
%
\begin{table}
  \centering%
  \begin{tabular}{c@{\qquad}*{9}{c}}
    \toprule
      \tabhead Publication
    & \tabhead\refContribution{survey}
    & \tabhead\refContribution{representations}
    & \multicolumn{5}{c}{\tabhead\refContribution{constraint-model}}
    & \tabhead\refContribution{solving-techniques}
    & \tabhead\refContribution{experiments} \\
    \cmidrule(lr){4-8}%
    &
    &
    & \tabhead\refContribution{cp-global-instruction-selection}
    & \tabhead\refContribution{cp-global-code-motion}
    & \tabhead\refContribution{cp-data-copying}
    & \tabhead\refContribution{cp-block-ordering}
    & \tabhead\refContribution{cp-value-reuse}
    &
    & \\
    \midrule
    \refPublication{survey-book}
    & \supportYes
    & \supportNo
    & \supportNo
    & \supportNo
    & \supportNo
    & \supportNo
    & \supportNo
    & \supportNo
    & \supportNo \\
    \refPublication{cp-paper}
    & \supportNo
    & \supportYes
    & \supportYes
    & \supportYes
    & \supportYes
    & \supportYes
    & \supportNo
    & \supportNo
    & \supportYes \\
    \refPublication{cases-paper}
    & \supportNo
    & \supportNo
    & \supportNo
    & \supportNo
    & \supportNo
    & \supportNo
    & \supportYes
    & \supportYes
    & \supportYes \\
    \bottomrule
  \end{tabular}

  \caption{Contributions per publication}
  \labelTable{contributions-per-publication}
\end{table}

The author also participated in the following publications, which are out of
scope for the dissertation:

\begin{publications}[resume]
  \item \labelPublication{survey-report}
    \fullcite{HjortBlindell:2013:Survey}.
  \item \labelPublication{lctes}
    \fullcite{CastanedaLozanoEtAl:2014:LCTES}.
  \item \labelPublication{cc}
    \fullcite{CastanedaLozanoEtAl:2016:CC}.
  \item \labelPublication{fdl-2016}
    \fullcite{HjortBlindellEtAl:2016:FDL}.
\end{publications}
%
\refPublication{survey-report} is excluded as it is subsumed and extended by
\refPublication{survey-book}. \refPublication{lctes} and \refPublication{cc} are
excluded as they are only partially related to the dissertation (they apply
\gls{constraint programming} to solve \gls{register allocation} and
\gls{instruction scheduling}). \refPublication{fdl-2016} is excluded as it
belongs to a different topic entirely (high-level code generation for graphics
processors).
